<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Maze RL: Q-Learning vs SARSA</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f7fa;
            color: #234;
            margin: 0;
            padding: 0;
        }
        h1 {
            margin-top: 30px;
            text-align: center;
        }
        #main {
            max-width: 880px;
            margin: 15px auto 30px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 16px #bed8f8aa;
            padding: 24px 18px 22px 18px;
        }
        form {
            margin-bottom: 17px;
            padding: 11px;
            background: #e4f0f7;
            border-radius: 7px;
        }
        label {
            margin-right: 16px;
            margin-bottom: 8px;
            min-width: 95px;
            display: inline-block;
        }
        input[type="number"], input[type="text"] {
            width: 58px;
            padding: 4px 6px;
            margin-bottom: 7px;
            margin-right: 12px;
            border-radius: 3px;
            border: 1px solid #b4d5f8;
        }
        .walls-input, .state-input {
            width: 165px;
        }
        button {
            background: #368ae6;
            color: #fff;
            border: none;
            padding: 7px 16px;
            border-radius: 4px;
            font-size: 15px;
            margin-top: 7px;
            cursor: pointer;
        }
        button:hover {
            background: #1a3e7b;
        }
        #mazeCanvas {
            display: block;
            margin: 12px auto 32px auto;
            background: #eaf4fe;
            border: 2px solid #368ae6;
            border-radius: 9px;
        }
        .agents-cfg {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
        }
        .agents-cfg > div {
            flex: 1;
        }
        @media (max-width: 780px) {
            #main { max-width: 99vw; }
            .agents-cfg { flex-direction: column; }
        }
        #stepsSummary {
            max-width:470px; 
            margin:0 auto 18px auto; 
            font-size:16px; 
            color:#234; 
            text-align:center; 
            font-weight:bold;
        }
        #pathPanel, #qtablePanel, #policyPanel {
            max-width:470px; 
            margin:0 auto 18px auto; 
            background:#f8faff; 
            border:1px solid #aaccee; 
            border-radius:6px; 
            padding:10px; 
            overflow-x:auto;
            display:none;
        }
    </style>
</head>
<body>
    <h1>Maze RL: Q-Learning vs SARSA</h1>
    <div id="main">
        <form id="mazeForm">
            <strong>Laberinto:</strong>
            <label>Filas
                <input type="number" id="rows" min="3" max="15" value="5" required />
            </label>
            <label>Columnas
                <input type="number" id="cols" min="3" max="15" value="5" required />
            </label>
            <label class="walls-input">Paredes (ej: 1,3;2,2)
                <input type="text" id="walls" placeholder="fila,col;fila2,col2" />
            </label>
            <label class="state-input">Inicio (ej: 0,0)
                <input type="text" id="start" value="0,0" />
            </label>
            <label class="state-input">Meta (ej: 4,4)
                <input type="text" id="goal" value="4,4" />
            </label>
            <label style="min-width:120px;">Recompensa meta
                <input type="number" id="reward_goal" value="1" step="0.01" style="width:60px;" />
            </label>
            <label style="min-width:120px;">Recompensa paso
                <input type="number" id="reward_step" value="-0.04" step="0.01" style="width:60px;" />
            </label>
            <button type="submit">Configurar Laberinto</button>
            <button id="randomWallsBtn" type="button" style="margin-left:10px;">Obstáculos aleatorios</button>
        </form>

        <div class="agents-cfg">
            <div>
                <form id="agentFormQL">
                    <strong>Q-Learning:</strong>
                    <label>Alpha
                        <input type="number" step="0.01" id="alpha_ql" value="0.1" />
                    </label>
                    <label>Gamma
                        <input type="number" step="0.01" id="gamma_ql" value="0.9" />
                    </label>
                    <label>Epsilon
                        <input type="number" step="0.01" id="epsilon_ql" value="0.1" />
                    </label>
                </form>
            </div>
            <div>
                <form id="agentFormSARSA">
                    <strong>SARSA:</strong>
                    <label>Alpha
                        <input type="number" step="0.01" id="alpha_sarsa" value="0.1" />
                    </label>
                    <label>Gamma
                        <input type="number" step="0.01" id="gamma_sarsa" value="0.9" />
                    </label>
                    <label>Epsilon
                        <input type="number" step="0.01" id="epsilon_sarsa" value="0.1" />
                    </label>
                </form>
            </div>
        </div>

        <button id="cfgAgentsBtn">Configurar Agentes</button>
        <button id="startBtn" style="margin-left:18px;">Iniciar Simulación</button>

        <div style="margin: 18px 0 10px 0; display: flex; justify-content: center; gap: 18px; align-items: center;">
            <label style="font-size:14px;">Velocidad
                <input type="range" id="speedSlider" min="50" max="1500" value="200" step="10" style="vertical-align:middle;" />
                <span id="speedValue">200</span> ms
            </label>
            <button id="pauseBtn" type="button">Pausar</button>
            <button id="resumeBtn" type="button" disabled>Reanudar</button>
            <button id="stepBtn" type="button">Paso a paso</button>
        </div>

        <div style="display: flex; justify-content: center; align-items: center; gap: 30px; margin-bottom: 6px;">
            <span style="display: flex; align-items: center; gap: 7px;">
                <span style="display:inline-block; width:22px; height:16px; background:rgba(50,125,230,0.5); border-radius:3px; border:1px solid #368ae6;"></span>
                <span style="font-weight:bold; color:#368ae6;">Q-Learning</span>
            </span>
            <span style="display: flex; align-items: center; gap: 7px;">
                <span style="display:inline-block; width:22px; height:16px; background:rgba(230,125,50,0.5); border-radius:3px; border:1px solid #e07b2a;"></span>
                <span style="font-weight:bold; color:#e07b2a;">SARSA</span>
            </span>
        </div>

        <div style="max-width: 470px; margin: 0 auto 18px auto;">
            <canvas id="mazeCanvas" width="470" height="470"></canvas>
        </div>

        <div style="max-width: 470px; margin: 0 auto 18px auto;">
            <canvas id="rewardsChart" width="470" height="220"></canvas>
        </div>

        <div id="stepsSummary"></div>

        <div style="max-width: 470px; margin: 0 auto 18px auto; display: flex; gap: 10px; justify-content: center;">
            <button id="exportQTableBtn" type="button">Exportar Q-table (JSON)</button>
            <button id="exportPolicyBtn" type="button">Exportar Política (JSON)</button>
            <button id="exportRewardsBtn" type="button">Exportar Recompensas (CSV)</button>
        </div>

        <div style="max-width: 470px; margin: 0 auto 18px auto; display: flex; gap: 10px; justify-content: center;">
            <button id="showQTableBtn" type="button">Ver Q-table</button>
            <button id="showPolicyBtn" type="button">Ver Política</button>
            <button id="showPathBtn" type="button">Ver Política (Trayectoria)</button>
            <select id="agentSelect">
                <option value="ql">Q-Learning</option>
                <option value="sarsa">SARSA</option>
            </select>
        </div>

        <div id="qtablePanel"></div>
        <div id="policyPanel"></div>
        <div id="pathPanel"></div>

        <ul id="infoPanel" style="max-width:470px; margin: 0 auto; font-family: monospace; background: #eef6ff; border: 1px solid #aaccee; padding: 10px; border-radius: 5px; min-height: 120px; list-style-type: none;"></ul>
    </div>

    <footer style="text-align:center; color:#234; font-size:15px; margin-bottom:18px; margin-top:10px;">
        Desarrollado por Giovanny Hidalgo - 2025
    </footer>
</body>
</html>
